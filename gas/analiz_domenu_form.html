<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
      min-height: 100vh;
      padding: 24px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .container { width: 100%; max-width: 560px; margin-top: 16px; }

    .card {
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 20px;
      padding: 36px 32px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
    }

    .header { text-align: center; margin-bottom: 28px; }
    .logo {
      width: 56px; height: 56px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 18px;
      font-size: 24px;
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
    }
    .header h1 { font-size: 21px; font-weight: 700; color: #1e293b; margin-bottom: 6px; letter-spacing: -0.3px; }
    .header p { font-size: 13px; color: #64748b; line-height: 1.5; }

    /* Phase label */
    .phase-label {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1.5px solid #f1f5f9;
    }
    .phase-badge {
      width: 36px; height: 36px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: white;
      font-size: 16px; font-weight: 700;
      flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
    }
    .phase-title { font-size: 16px; font-weight: 700; color: #1e293b; }
    .phase-desc { font-size: 12px; color: #64748b; margin-top: 2px; }

    /* Phase divider */
    .phase-divider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 24px 0;
      padding: 0 8px;
    }
    .phase-divider-line { flex: 1; height: 1px; background: #e2e8f0; }
    .phase-divider-arrow {
      width: 32px; height: 32px;
      background: #eef2ff;
      border: 1.5px solid #c7d2fe;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; color: #6366f1;
      flex-shrink: 0;
    }
    .phase-divider-text { font-size: 11px; color: #94a3b8; white-space: nowrap; }

    /* Phase 2 hint */
    .phase2-hint {
      display: none;
      align-items: flex-start;
      gap: 8px;
      padding: 10px 14px;
      background: #eef2ff;
      border: 1px solid #c7d2fe;
      border-radius: 8px;
      font-size: 12px;
      color: #4338ca;
      line-height: 1.5;
      margin-bottom: 16px;
      animation: slideIn 0.25s ease;
    }
    .phase2-hint.visible { display: flex; }

    /* Form */
    .form-group { margin-bottom: 16px; }
    label { display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 6px; }

    .input-wrapper { position: relative; }
    .input-icon {
      position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      font-size: 16px; opacity: 0.4; pointer-events: none; transition: opacity 0.2s;
    }

    input[type="text"], input[type="email"], select {
      width: 100%;
      padding: 12px 12px 12px 42px;
      font-size: 14px; font-family: inherit; color: #1e293b;
      background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 10px;
      outline: none; transition: all 0.2s ease;
    }
    select { padding-left: 12px; cursor: pointer; }

    input::placeholder { color: #94a3b8; }
    input:hover, select:hover { border-color: #cbd5e1; background: #f1f5f9; }
    input:focus, select:focus { border-color: #6366f1; background: #fff; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.12); }
    input:focus + .input-icon { opacity: 0.7; }

    /* Section blocks */
    .section-block {
      margin-top: 20px;
      border: 1.5px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
      transition: border-color 0.2s;
    }
    .section-block:first-of-type { margin-top: 0; }
    .section-block.active { border-color: #a5b4fc; }

    .section-header {
      display: flex; align-items: center; gap: 12px;
      padding: 14px 16px;
      background: #f8fafc;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s;
    }
    .section-header:hover { background: #f1f5f9; }
    .section-block.active .section-header { background: #eef2ff; }

    .section-toggle {
      width: 38px; height: 22px;
      background: #cbd5e1; border-radius: 11px;
      position: relative; flex-shrink: 0;
      transition: background 0.2s;
      cursor: pointer;
    }
    .section-toggle::after {
      content: '';
      position: absolute; top: 3px; left: 3px;
      width: 16px; height: 16px;
      background: white; border-radius: 50%;
      transition: transform 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }
    .section-block.active .section-toggle { background: #6366f1; }
    .section-block.active .section-toggle::after { transform: translateX(16px); }

    .section-icon { font-size: 18px; }
    .section-title { flex: 1; font-size: 14px; font-weight: 600; color: #374151; }
    .section-desc { font-size: 11px; color: #94a3b8; font-weight: 400; }

    .section-body {
      max-height: 0; overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
      padding: 0 16px;
    }
    .section-block.active .section-body {
      max-height: 800px;
      padding: 16px;
    }

    .row { display: flex; gap: 12px; }
    .row .form-group { flex: 1; }

    /* Tags input for competitors */
    .tags-container {
      display: flex; flex-wrap: wrap; gap: 6px;
      padding: 8px 10px;
      min-height: 44px;
      background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 10px;
      cursor: text; transition: all 0.2s;
    }
    .tags-container:focus-within {
      border-color: #6366f1; background: #fff;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.12);
    }

    .tag {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 4px 10px;
      background: #eef2ff; border: 1px solid #c7d2fe; border-radius: 6px;
      font-size: 13px; color: #4338ca;
      animation: tagIn 0.15s ease;
    }
    @keyframes tagIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    .tag-remove {
      cursor: pointer; font-size: 14px; color: #818cf8;
      width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;
      border-radius: 4px; transition: all 0.15s;
    }
    .tag-remove:hover { color: #dc2626; background: #fee2e2; }

    .tags-input {
      flex: 1; min-width: 80px; border: none; outline: none;
      font-size: 13px; font-family: inherit; background: transparent;
      padding: 4px 0;
    }

    .tags-hint {
      font-size: 11px; color: #94a3b8; margin-top: 4px;
    }

    /* Options cards */
    .options-row { display: flex; gap: 8px; }
    .option-card {
      flex: 1; display: flex; align-items: center; gap: 8px;
      padding: 10px 12px;
      background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px;
      cursor: pointer; user-select: none; transition: all 0.15s;
    }
    .option-card:hover { border-color: #cbd5e1; }
    .option-card.selected { background: #eef2ff; border-color: #a5b4fc; }
    .option-icon { font-size: 16px; }
    .option-label { font-size: 13px; font-weight: 500; color: #374151; }
    .option-check { font-size: 14px; margin-left: auto; }

    /* Button */
    .btn {
      width: 100%; padding: 14px 24px; margin-top: 24px;
      font-size: 14px; font-weight: 600; font-family: inherit;
      color: white; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border: none; border-radius: 10px; cursor: pointer;
      transition: all 0.2s ease; position: relative; overflow: hidden; letter-spacing: 0.2px;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.35); }
    .btn:active { transform: translateY(0); }
    .btn span { display: flex; align-items: center; justify-content: center; gap: 8px; }
    .btn:disabled { opacity: 0.65; cursor: not-allowed; transform: none; box-shadow: none; }

    .btn-loading span { visibility: hidden; }
    .btn-loading::after {
      content: ''; position: absolute; top: 50%; left: 50%;
      width: 20px; height: 20px; margin: -10px 0 0 -10px;
      border: 2px solid rgba(255,255,255,0.3); border-top-color: white;
      border-radius: 50%; animation: spin 0.7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Per-section submit button (Phase 2) */
    .btn-section {
      width: 100%; padding: 12px 20px; margin-top: 16px;
      font-size: 13px; font-weight: 600; font-family: inherit;
      color: white;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border: none; border-radius: 10px; cursor: pointer;
      transition: all 0.2s ease; position: relative; overflow: hidden;
    }
    .btn-section:hover { transform: translateY(-1px); box-shadow: 0 4px 14px rgba(99, 102, 241, 0.3); }
    .btn-section:active { transform: translateY(0); }
    .btn-section:disabled { opacity: 0.65; cursor: not-allowed; transform: none; box-shadow: none; }
    .btn-section span { display: flex; align-items: center; justify-content: center; gap: 6px; }
    .btn-section-loading span { visibility: hidden; }
    .btn-section-loading::after {
      content: ''; position: absolute; top: 50%; left: 50%;
      width: 18px; height: 18px; margin: -9px 0 0 -9px;
      border: 2px solid rgba(255,255,255,0.3); border-top-color: white;
      border-radius: 50%; animation: spin 0.7s linear infinite;
    }

    /* Result */
    .result {
      margin-top: 20px; padding: 16px 18px; border-radius: 10px;
      display: none; animation: slideIn 0.25s ease;
    }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }
    .result.success { display: block; background: #f0fdf4; border: 1px solid #bbf7d0; }
    .result.error { display: block; background: #fef2f2; border: 1px solid #fecaca; }

    .result-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .result-icon {
      width: 28px; height: 28px; border-radius: 7px;
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; font-weight: 700;
    }
    .result.success .result-icon { background: #dcfce7; color: #16a34a; }
    .result.error .result-icon { background: #fee2e2; color: #dc2626; }
    .result h3 { font-size: 14px; font-weight: 600; }
    .result.success h3 { color: #15803d; }
    .result.error h3 { color: #dc2626; }
    .result p { font-size: 13px; color: #475569; line-height: 1.5; }

    .result a {
      display: inline-flex; align-items: center; gap: 6px;
      margin-top: 12px; padding: 9px 14px;
      font-size: 13px; font-weight: 500;
      color: #15803d; background: #dcfce7; border: 1px solid #bbf7d0;
      border-radius: 7px; text-decoration: none; transition: all 0.2s;
    }
    .result a:hover { background: #bbf7d0; }

    /* Per-section result panel */
    .section-result {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 10px;
      animation: slideIn 0.25s ease;
    }
    .section-result.success { background: #f0fdf4; border: 1px solid #bbf7d0; }
    .section-result.error { background: #fef2f2; border: 1px solid #fecaca; }
    .section-result.loading { background: #eef2ff; border: 1px solid #c7d2fe; }
    .section-result-header {
      display: flex; align-items: center; gap: 8px;
      font-size: 13px; font-weight: 600;
    }
    .section-result.success .section-result-header { color: #15803d; }
    .section-result.error .section-result-header { color: #dc2626; }
    .section-result.loading .section-result-header { color: #4338ca; }
    .section-result-icon { font-size: 14px; }
    .section-result-link-row {
      display: flex; align-items: center; gap: 8px;
      margin-top: 8px;
    }
    .section-result-link {
      flex: 1;
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 12px;
      font-size: 12px; font-weight: 500;
      color: #15803d; background: #dcfce7;
      border: 1px solid #bbf7d0; border-radius: 7px;
      text-decoration: none; transition: all 0.2s;
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    }
    .section-result-link:hover { background: #bbf7d0; }
    .section-result-link.ai-link {
      color: #6d28d9; background: #ede9fe; border-color: #ddd6fe;
    }
    .section-result-link.ai-link:hover { background: #ddd6fe; }

    /* Copy button */
    .copy-btn {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      background: #f0fdf4; border: 1px solid #bbf7d0;
      border-radius: 7px; cursor: pointer;
      font-size: 14px; transition: all 0.2s;
      flex-shrink: 0;
    }
    .copy-btn:hover { background: #dcfce7; }
    .copy-btn.copied { background: #dcfce7; border-color: #22c55e; }

    /* Competitor sub-results */
    .competitor-result-item {
      display: flex; align-items: center; gap: 8px;
      padding: 6px 0; font-size: 12px; color: #475569;
    }
    .competitor-result-item a {
      color: #15803d; text-decoration: none; font-weight: 500;
      margin: 0; padding: 0; background: none; border: none;
      display: inline;
    }
    .competitor-result-item a:hover { text-decoration: underline; }
    .competitor-result-item .copy-btn {
      width: 24px; height: 24px; font-size: 11px;
      display: inline-flex;
    }

    /* Status dots */
    .status-dot {
      width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
    }
    .status-dot.success { background: #22c55e; }
    .status-dot.error { background: #ef4444; }
    .status-dot.skipped { background: #d1d5db; }

    /* Footer */
    .footer {
      margin-top: 20px; padding: 16px 0 0;
      display: flex; align-items: center; justify-content: space-between;
    }
    .footer-time { display: flex; align-items: center; gap: 6px; font-size: 12px; color: #64748b; }
    .footer-time svg { width: 14px; height: 14px; opacity: 0.6; }
    .footer-brand { font-size: 11px; color: #94a3b8; }
    .footer-brand span { color: #6366f1; font-weight: 600; }

    /* Warning */
    .warning-box {
      margin-top: 12px; padding: 10px 14px;
      background: #fffbeb; border: 1px solid #fde68a; border-radius: 8px;
      font-size: 12px; color: #92400e; line-height: 1.5;
    }

    /* Tooltips */
    .field-hint {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      margin-top: 6px;
      padding: 8px 10px;
      background: #f0f4ff;
      border: 1px solid #e0e7ff;
      border-radius: 8px;
      font-size: 11px;
      color: #475569;
      line-height: 1.5;
    }
    .field-hint-icon {
      flex-shrink: 0;
      font-size: 13px;
      margin-top: 1px;
    }
    .section-hint {
      margin-bottom: 12px;
      padding: 8px 10px;
      background: #faf5ff;
      border: 1px solid #ede9fe;
      border-radius: 8px;
      font-size: 11px;
      color: #6b7280;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- ======================================== -->
    <!-- PHASE 1: Data Collection                 -->
    <!-- ======================================== -->
    <div class="card" id="phase1Card">
      <div class="header">
        <div class="logo">üöÄ</div>
        <h1>SEO-–∞—É–¥–∏—Ç ‚Äî –ú–∞—Å—Ç–µ—Ä</h1>
        <p>–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä: –∑–±—ñ—Ä –¥–∞–Ω–∏—Ö, –∞–Ω–∞–ª—ñ–∑, —Å–µ–º–∞–Ω—Ç–∏–∫–∞, –º–µ—Ç—Ä–∏–∫–∏, PageSpeed, AI-–∑–≤—ñ—Ç–∏</p>
      </div>

      <!-- Email (required, shared) -->
      <div class="form-group">
        <label>Email –º–µ–Ω–µ–¥–∂–µ—Ä–∞ *</label>
        <div class="input-wrapper">
          <input type="email" id="managerEmail" placeholder="manager@webpromo.com.ua" autocomplete="off" spellcheck="false">
          <span class="input-icon">üìß</span>
        </div>
        <div class="field-hint">
          <span class="field-hint-icon">üí°</span>
          <span>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –±—É–¥—É—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —É –≤–∞—à—É –ø–∞–ø–∫—É –Ω–∞ Google Drive. –Ø–∫—â–æ –ø–∞–ø–∫–∏ —â–µ –Ω–µ–º–∞—î ‚Äî –≤–æ–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</span>
        </div>
      </div>

      <!-- Phase 1 label -->
      <div class="phase-label">
        <div class="phase-badge">1</div>
        <div>
          <div class="phase-title">–ó–±—ñ—Ä –¥–∞–Ω–∏—Ö</div>
          <div class="phase-desc">–ê–Ω–∞–ª—ñ–∑ –∫–ª—ñ—î–Ω—Ç–∞, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤, —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ —è–¥—Ä–∞</div>
        </div>
      </div>

      <!-- 1. Client analysis -->
      <div class="section-block" id="clientSection">
        <div class="section-header" onclick="toggleSection('clientSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">üîç</span>
          <div>
            <div class="section-title">–ê–Ω–∞–ª—ñ–∑ –∫–ª—ñ—î–Ω—Ç–∞</div>
            <div class="section-desc">SEO-–∞—É–¥–∏—Ç –¥–æ–º–µ–Ω—É –∫–ª—ñ—î–Ω—Ç–∞</div>
          </div>
        </div>
        <div class="section-body">
          <div class="section-hint">–ó–±–∏—Ä–∞—î –æ—Ä–≥–∞–Ω—ñ—á–Ω–∏–π —Ç—Ä–∞—Ñ—ñ–∫, –∫–ª—é—á–æ–≤—ñ —Ñ—Ä–∞–∑–∏, –ø–æ—Å–∏–ª–∞–ª—å–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å —Ç–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ –¥–æ–º–µ–Ω—É. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî Google —Ç–∞–±–ª–∏—Ü—è –∑ 6 –≤–∫–ª–∞–¥–∫–∞–º–∏.</div>
          <div class="form-group">
            <label>–î–æ–º–µ–Ω –∫–ª—ñ—î–Ω—Ç–∞</label>
            <div class="input-wrapper">
              <input type="text" id="clientDomain" placeholder="example.com.ua" autocomplete="off" spellcheck="false">
              <span class="input-icon">üîó</span>
            </div>
            <div class="field-hint">
              <span class="field-hint-icon">üí°</span>
              <span>–í–≤–æ–¥—å—Ç–µ –¥–æ–º–µ–Ω –±–µ–∑ https:// —Ç–∞ www. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: rozetka.com.ua</span>
            </div>
          </div>
          <div class="section-result" id="clientResult" style="display:none;"></div>
        </div>
      </div>

      <!-- 2. Competitors -->
      <div class="section-block" id="competitorsSection">
        <div class="section-header" onclick="toggleSection('competitorsSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">‚öîÔ∏è</span>
          <div>
            <div class="section-title">–ê–Ω–∞–ª—ñ–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤</div>
            <div class="section-desc">SEO-–∞—É–¥–∏—Ç –¥–æ–º–µ–Ω—ñ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤</div>
          </div>
        </div>
        <div class="section-body">
          <div class="section-hint">–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –æ–∫—Ä–µ–º–∞ —Ç–∞–±–ª–∏—Ü—è –∑ —Ç–∏–º–∏ –∂ –º–µ—Ç—Ä–∏–∫–∞–º–∏, —â–æ –π –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ.</div>
          <div class="form-group">
            <label>–î–æ–º–µ–Ω–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤</label>
            <div class="tags-container" id="competitorsTags" onclick="document.getElementById('competitorsInput').focus()">
              <input type="text" class="tags-input" id="competitorsInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –¥–æ–º–µ–Ω —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Enter" spellcheck="false">
            </div>
            <div class="tags-hint">Enter ‚Äî –¥–æ–¥–∞—Ç–∏, Backspace ‚Äî –≤–∏–¥–∞–ª–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π. –ú–æ–∂–Ω–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ Ctrl+V</div>
          </div>
          <div class="section-result" id="competitorsResult" style="display:none;"></div>
        </div>
      </div>

      <!-- 3. Semantic expansion -->
      <div class="section-block" id="semanticSection">
        <div class="section-header" onclick="toggleSection('semanticSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">üå±</span>
          <div>
            <div class="section-title">–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ —è–¥—Ä–∞</div>
            <div class="section-desc">GKP: –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —ñ–¥–µ–π –∑ seed-—Ñ—Ä–∞–∑</div>
          </div>
        </div>
        <div class="section-body">
          <div class="section-hint">Google Keyword Planner –≥–µ–Ω–µ—Ä—É—î –Ω–æ–≤—ñ —ñ–¥–µ—ó –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤–∞—à–∏—Ö seed-—Ñ—Ä–∞–∑. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —Ç–∞–±–ª–∏—Ü—è –∑ —É—Å—ñ–º–∞ –∑–Ω–∞–π–¥–µ–Ω–∏–º–∏ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏.</div>
          <div class="form-group">
            <label>–¢–∞–±–ª–∏—Ü—è –∑ seed-—Ñ—Ä–∞–∑–∞–º–∏</label>
            <div class="input-wrapper">
              <input type="text" id="semanticUrl" placeholder="https://docs.google.com/spreadsheets/d/..." autocomplete="off" spellcheck="false">
              <span class="input-icon">üìã</span>
            </div>
            <div class="field-hint">
              <span class="field-hint-icon">üí°</span>
              <span>Seed-—Ñ—Ä–∞–∑–∏ –º–∞—é—Ç—å –±—É—Ç–∏ —É –ø–µ—Ä—à–æ–º—É —Å—Ç–æ–≤–ø—Ü—ñ –ø–µ—Ä—à–æ–≥–æ –∞—Ä–∫—É—à–∞ —Ç–∞–±–ª–∏—Ü—ñ.</span>
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label>–ú–æ–≤–∞</label>
              <select id="semanticLang">
                <option value="1036" selected>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                <option value="1000">English</option>
                <option value="1030">Polski</option>
                <option value="1031">–†—É—Å—Å–∫–∏–π</option>
                <option value="1001">Deutsch</option>
                <option value="1002">Fran√ßais</option>
                <option value="1003">Espa√±ol</option>
                <option value="1004">Italiano</option>
                <option value="1014">Portugu√™s</option>
                <option value="1010">Nederlands</option>
                <option value="1021">ƒåe≈°tina</option>
                <option value="1032">Rom√¢nƒÉ</option>
                <option value="1024">Magyar</option>
                <option value="1015">Svenska</option>
                <option value="1037">T√ºrk√ße</option>
                <option value="1009">Dansk</option>
                <option value="1013">Norsk</option>
                <option value="1011">Suomi</option>
                <option value="1033">Slovenƒçina</option>
                <option value="1020">–ë—ä–ª–≥–∞—Ä—Å–∫–∏</option>
              </select>
            </div>
            <div class="form-group">
              <label>–†–µ–≥—ñ–æ–Ω</label>
              <select id="semanticGeo">
                <option value="2804" selected>–£–∫—Ä–∞—ó–Ω–∞</option>
                <option value="2840">–°–®–ê</option>
                <option value="2826">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω—ñ—è</option>
                <option value="2616">–ü–æ–ª—å—â–∞</option>
                <option value="2276">–ù—ñ–º–µ—á—á–∏–Ω–∞</option>
                <option value="2250">–§—Ä–∞–Ω—Ü—ñ—è</option>
                <option value="2724">–Ü—Å–ø–∞–Ω—ñ—è</option>
                <option value="2380">–Ü—Ç–∞–ª—ñ—è</option>
                <option value="2528">–ù—ñ–¥–µ—Ä–ª–∞–Ω–¥–∏</option>
                <option value="2124">–ö–∞–Ω–∞–¥–∞</option>
                <option value="2036">–ê–≤—Å—Ç—Ä–∞–ª—ñ—è</option>
                <option value="2203">–ß–µ—Ö—ñ—è</option>
                <option value="2642">–†—É–º—É–Ω—ñ—è</option>
                <option value="2040">–ê–≤—Å—Ç—Ä—ñ—è</option>
                <option value="2756">–®–≤–µ–π—Ü–∞—Ä—ñ—è</option>
                <option value="2792">–¢—É—Ä–µ—á—á–∏–Ω–∞</option>
                <option value="2752">–®–≤–µ—Ü—ñ—è</option>
                <option value="2620">–ü–æ—Ä—Ç—É–≥–∞–ª—ñ—è</option>
                <option value="2056">–ë–µ–ª—å–≥—ñ—è</option>
                <option value="2348">–£–≥–æ—Ä—â–∏–Ω–∞</option>
              </select>
            </div>
          </div>
          <div class="section-result" id="semanticResult" style="display:none;"></div>
        </div>
      </div>

      <div class="warning-box" id="phase1Warning" style="display: none;">
        –£–≤—ñ–º–∫–Ω—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –±–ª–æ–∫ –ï—Ç–∞–ø—É 1
      </div>

      <button class="btn" id="phase1Btn" onclick="handlePhase1Submit()">
        <span>üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ï—Ç–∞–ø 1</span>
      </button>

      <div class="result" id="phase1Result"></div>
    </div>

    <!-- ======================================== -->
    <!-- PHASE DIVIDER                            -->
    <!-- ======================================== -->
    <div class="phase-divider">
      <div class="phase-divider-line"></div>
      <div class="phase-divider-arrow">‚Üì</div>
      <div class="phase-divider-text">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ï—Ç–∞–ø—É 1 ‚Üí –ï—Ç–∞–ø 2</div>
      <div class="phase-divider-line"></div>
    </div>

    <!-- ======================================== -->
    <!-- PHASE 2: Analysis & Processing           -->
    <!-- ======================================== -->
    <div class="card" id="phase2Card">

      <!-- Phase 2 label -->
      <div class="phase-label">
        <div class="phase-badge">2</div>
        <div>
          <div class="phase-title">–ê–Ω–∞–ª—ñ–∑ —Ç–∞ –æ–±—Ä–æ–±–∫–∞</div>
          <div class="phase-desc">–ú–µ—Ç—Ä–∏–∫–∏, PageSpeed, AI-–∞–Ω–∞–ª—ñ–∑, PDF-–ø–∞—Ä—Å–∏–Ω–≥ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ï—Ç–∞–ø—É 1</div>
        </div>
      </div>

      <div class="phase2-hint" id="phase2Hint">
        <span class="field-hint-icon">üîó</span>
        <span>–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ –∑ –ï—Ç–∞–ø—É 1 –¥–æ—Å—Ç—É–ø–Ω—ñ –≤–∏—â–µ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å üìã —â–æ–± —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ —Å—é–¥–∏.</span>
      </div>

      <!-- 4. Metrics -->
      <div class="section-block" id="metricsSection">
        <div class="section-header" onclick="toggleSection('metricsSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">üìä</span>
          <div>
            <div class="section-title">–û—Ç—Ä–∏–º–∞–Ω–Ω—è –º–µ—Ç—Ä–∏–∫</div>
            <div class="section-desc">GKP: –æ–±'—î–º –ø–æ—à—É–∫—É –¥–ª—è –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤</div>
          </div>
        </div>
        <div class="section-body">
          <div class="section-hint">–û—Ç—Ä–∏–º—É—î –æ–±'—î–º –ø–æ—à—É–∫—É, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü—ñ—é —Ç–∞ CPC –¥–ª—è —Å–ø–∏—Å–∫—É –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤ —á–µ—Ä–µ–∑ Google Keyword Planner. –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –≤–∂–µ –∑—ñ–±—Ä–∞–Ω–æ–≥–æ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ —è–¥—Ä–∞.</div>
          <div class="form-group">
            <label>–¢–∞–±–ª–∏—Ü—è –∑ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏</label>
            <div class="input-wrapper">
              <input type="text" id="metricsUrl" placeholder="https://docs.google.com/spreadsheets/d/..." autocomplete="off" spellcheck="false">
              <span class="input-icon">üìã</span>
            </div>
            <div class="field-hint">
              <span class="field-hint-icon">üí°</span>
              <span>–ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –º–∞—é—Ç—å –±—É—Ç–∏ —É –ø–µ—Ä—à–æ–º—É —Å—Ç–æ–≤–ø—Ü—ñ. –ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑ –ï—Ç–∞–ø—É 1 ¬´–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å–µ–º–∞–Ω—Ç–∏–∫–∏¬ª.</span>
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label>–ú–æ–≤–∞</label>
              <select id="metricsLang">
                <option value="1036" selected>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                <option value="1000">English</option>
                <option value="1030">Polski</option>
                <option value="1031">–†—É—Å—Å–∫–∏–π</option>
                <option value="1001">Deutsch</option>
                <option value="1002">Fran√ßais</option>
                <option value="1003">Espa√±ol</option>
                <option value="1004">Italiano</option>
                <option value="1014">Portugu√™s</option>
                <option value="1010">Nederlands</option>
                <option value="1021">ƒåe≈°tina</option>
                <option value="1032">Rom√¢nƒÉ</option>
                <option value="1024">Magyar</option>
                <option value="1015">Svenska</option>
                <option value="1037">T√ºrk√ße</option>
                <option value="1009">Dansk</option>
                <option value="1013">Norsk</option>
                <option value="1011">Suomi</option>
                <option value="1033">Slovenƒçina</option>
                <option value="1020">–ë—ä–ª–≥–∞—Ä—Å–∫–∏</option>
              </select>
            </div>
            <div class="form-group">
              <label>–†–µ–≥—ñ–æ–Ω</label>
              <select id="metricsGeo">
                <option value="2804" selected>–£–∫—Ä–∞—ó–Ω–∞</option>
                <option value="2840">–°–®–ê</option>
                <option value="2826">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω—ñ—è</option>
                <option value="2616">–ü–æ–ª—å—â–∞</option>
                <option value="2276">–ù—ñ–º–µ—á—á–∏–Ω–∞</option>
                <option value="2250">–§—Ä–∞–Ω—Ü—ñ—è</option>
                <option value="2724">–Ü—Å–ø–∞–Ω—ñ—è</option>
                <option value="2380">–Ü—Ç–∞–ª—ñ—è</option>
                <option value="2528">–ù—ñ–¥–µ—Ä–ª–∞–Ω–¥–∏</option>
                <option value="2124">–ö–∞–Ω–∞–¥–∞</option>
                <option value="2036">–ê–≤—Å—Ç—Ä–∞–ª—ñ—è</option>
                <option value="2203">–ß–µ—Ö—ñ—è</option>
                <option value="2642">–†—É–º—É–Ω—ñ—è</option>
                <option value="2040">–ê–≤—Å—Ç—Ä—ñ—è</option>
                <option value="2756">–®–≤–µ–π—Ü–∞—Ä—ñ—è</option>
                <option value="2792">–¢—É—Ä–µ—á—á–∏–Ω–∞</option>
                <option value="2752">–®–≤–µ—Ü—ñ—è</option>
                <option value="2620">–ü–æ—Ä—Ç—É–≥–∞–ª—ñ—è</option>
                <option value="2056">–ë–µ–ª—å–≥—ñ—è</option>
                <option value="2348">–£–≥–æ—Ä—â–∏–Ω–∞</option>
              </select>
            </div>
          </div>
          <button class="btn-section" id="metricsBtn" onclick="handleMetricsSubmit()">
            <span>üìä –û—Ç—Ä–∏–º–∞—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏</span>
          </button>
          <div class="section-result" id="metricsResult" style="display:none;"></div>
        </div>
      </div>

      <!-- 5. PageSpeed -->
      <div class="section-block" id="pagespeedSection">
        <div class="section-header" onclick="toggleSection('pagespeedSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">‚ö°</span>
          <div>
            <div class="section-title">PageSpeed Test</div>
            <div class="section-desc">–ê–Ω–∞–ª—ñ–∑ —à–≤–∏–¥–∫–æ—Å—Ç—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫</div>
          </div>
        </div>
        <div class="section-body">
          <div class="section-hint">–¢–µ—Å—Ç—É—î —à–≤–∏–¥–∫—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫ —á–µ—Ä–µ–∑ Google PageSpeed Insights API. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî Core Web Vitals (LCP, FID, CLS) —Ç–∞ –æ—Ü—ñ–Ω–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–ª—è –∫–æ–∂–Ω–æ—ó URL.</div>
          <div class="form-group">
            <label>–¢–∞–±–ª–∏—Ü—è –∑ URL –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</label>
            <div class="input-wrapper">
              <input type="text" id="pagespeedUrl" placeholder="https://docs.google.com/spreadsheets/d/..." autocomplete="off" spellcheck="false">
              <span class="input-icon">üìã</span>
            </div>
            <div class="field-hint">
              <span class="field-hint-icon">üí°</span>
              <span>URL-–∞–¥—Ä–µ—Å–∏ —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –º–∞—é—Ç—å –±—É—Ç–∏ —É –ø–µ—Ä—à–æ–º—É —Å—Ç–æ–≤–ø—Ü—ñ. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –±–∞—Ç—á–∞–º–∏ –ø–æ 5 URL –∑ –ø–∞—É–∑–∞–º–∏.</span>
            </div>
          </div>
          <div class="form-group">
            <label>–¢–∏–ø —Ç–µ—Å—Ç—É</label>
            <div class="options-row">
              <div class="option-card selected" id="optMobile" onclick="toggleOption('optMobile')">
                <span class="option-icon">üì±</span>
                <span class="option-label">Mobile</span>
                <span class="option-check">‚úì</span>
              </div>
              <div class="option-card selected" id="optDesktop" onclick="toggleOption('optDesktop')">
                <span class="option-icon">üñ•Ô∏è</span>
                <span class="option-label">Desktop</span>
                <span class="option-check">‚úì</span>
              </div>
            </div>
          </div>
          <button class="btn-section" id="pagespeedBtn" onclick="handlePageSpeedSubmit()">
            <span>‚ö° –ó–∞–ø—É—Å—Ç–∏—Ç–∏ PageSpeed</span>
          </button>
          <div class="section-result" id="pagespeedResult" style="display:none;"></div>
        </div>
      </div>

      <!-- 6. AI Analysis (NEW) -->
      <div class="section-block" id="aiSection">
        <div class="section-header" onclick="toggleSection('aiSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">ü§ñ</span>
          <div>
            <div class="section-title">AI –∞–Ω–∞–ª—ñ–∑ –¥–æ–º–µ–Ω—É</div>
            <div class="section-desc">AI-–∑–≤—ñ—Ç –∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ –∞–Ω–∞–ª—ñ–∑—É</div>
          </div>
        </div>
        <div class="section-body">
          <div class="section-hint">–ó–≥–µ–Ω–µ—Ä—É—î AI-–∑–≤—ñ—Ç (Google Doc) –∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≥–æ—Ç–æ–≤–æ—ó —Ç–∞–±–ª–∏—Ü—ñ –∞–Ω–∞–ª—ñ–∑—É –¥–æ–º–µ–Ω—É. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ¬´–ê–Ω–∞–ª—ñ–∑ –∫–ª—ñ—î–Ω—Ç–∞¬ª –∑ –ï—Ç–∞–ø—É 1 –∞–±–æ –±—É–¥—å-—è–∫—É —ñ–Ω—à—É —Ç–∞–±–ª–∏—Ü—é.</div>
          <div class="form-group">
            <label>–¢–∞–±–ª–∏—Ü—è –∑ –∞–Ω–∞–ª—ñ–∑–æ–º –¥–æ–º–µ–Ω—É</label>
            <div class="input-wrapper">
              <input type="text" id="aiSpreadsheetUrl" placeholder="https://docs.google.com/spreadsheets/d/..." autocomplete="off" spellcheck="false">
              <span class="input-icon">üìã</span>
            </div>
            <div class="field-hint">
              <span class="field-hint-icon">üí°</span>
              <span>–í—Å—Ç–∞–≤—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é –∞–Ω–∞–ª—ñ–∑—É –∫–ª—ñ—î–Ω—Ç–∞ –∑ –ï—Ç–∞–ø—É 1 (–∫–Ω–æ–ø–∫–∞ üìã) –∞–±–æ –±—É–¥—å-—è–∫—É —ñ–Ω—à—É —Ç–∞–±–ª–∏—Ü—é –∞–Ω–∞–ª—ñ–∑—É.</span>
            </div>
          </div>
          <button class="btn-section" id="aiBtn" onclick="handleAiSubmit()">
            <span>ü§ñ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ AI –∞–Ω–∞–ª—ñ–∑</span>
          </button>
          <div class="section-result" id="aiResult" style="display:none;"></div>
        </div>
      </div>

      <!-- 7. PDF Parsing (NEW) -->
      <div class="section-block" id="pdfSection">
        <div class="section-header" onclick="toggleSection('pdfSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">üìÑ</span>
          <div>
            <div class="section-title">–ü–∞—Ä—Å–∏–Ω–≥ PDF-–∞—É–¥–∏—Ç—É</div>
            <div class="section-desc">PDF —É —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—É Google —Ç–∞–±–ª–∏—Ü—é</div>
          </div>
        </div>
        <div class="section-body">
          <div class="section-hint">–ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î PDF-–∞—É–¥–∏—Ç –∑ Google Drive —É —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—É Google —Ç–∞–±–ª–∏—Ü—é –∑ –æ–∫—Ä–µ–º–∏–º–∏ –≤–∫–ª–∞–¥–∫–∞–º–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É –∞—É–¥–∏—Ç—É.</div>
          <div class="form-group">
            <label>–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ PDF (Google Drive)</label>
            <div class="input-wrapper">
              <input type="text" id="pdfUrl" placeholder="https://drive.google.com/file/d/..." autocomplete="off" spellcheck="false">
              <span class="input-icon">üìé</span>
            </div>
            <div class="field-hint">
              <span class="field-hint-icon">üí°</span>
              <span>PDF —Ñ–∞–π–ª –º–∞—î –±—É—Ç–∏ –Ω–∞ Google Drive —Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É.</span>
            </div>
          </div>
          <button class="btn-section" id="pdfBtn" onclick="handlePdfSubmit()">
            <span>üìÑ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥ PDF</span>
          </button>
          <div class="section-result" id="pdfResult" style="display:none;"></div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div class="footer-time">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        –ß–∞—Å –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –æ–±—Ä–∞–Ω–∏—Ö –±–ª–æ–∫—ñ–≤
      </div>
      <div class="footer-brand">
        <span>WebPromo</span>
      </div>
    </div>

  </div>

  <script>
    // ======================================
    // Section toggles
    // ======================================
    function toggleSection(sectionId) {
      var el = document.getElementById(sectionId);
      el.classList.toggle('active');
      updateWarning();
    }

    function isSectionActive(sectionId) {
      return document.getElementById(sectionId).classList.contains('active');
    }

    function updateWarning() {
      var anyActive = isSectionActive('clientSection') || isSectionActive('competitorsSection') ||
        isSectionActive('semanticSection');
      document.getElementById('phase1Warning').style.display = anyActive ? 'none' : 'block';
    }

    // ======================================
    // Option cards (PageSpeed)
    // ======================================
    function toggleOption(id) {
      document.getElementById(id).classList.toggle('selected');
    }

    // ======================================
    // Competitors tags
    // ======================================
    var competitors = [];

    function addCompetitor(val) {
      var clean = val.replace(/^https?:\/\//i, '').replace(/^www\./i, '').replace(/\/+$/, '').trim().toLowerCase();
      if (!clean || competitors.indexOf(clean) !== -1) return;
      competitors.push(clean);
      renderCompetitors();
    }

    function removeCompetitor(idx) {
      competitors.splice(idx, 1);
      renderCompetitors();
    }

    function renderCompetitors() {
      var container = document.getElementById('competitorsTags');
      var input = document.getElementById('competitorsInput');
      var tags = container.querySelectorAll('.tag');
      for (var i = 0; i < tags.length; i++) tags[i].remove();
      for (var i = 0; i < competitors.length; i++) {
        var tag = document.createElement('span');
        tag.className = 'tag';
        tag.innerHTML = competitors[i] + '<span class="tag-remove" data-idx="' + i + '">√ó</span>';
        container.insertBefore(tag, input);
      }
    }

    document.getElementById('competitorsInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        if (this.value.trim()) { addCompetitor(this.value); this.value = ''; }
      }
      if (e.key === 'Backspace' && this.value === '' && competitors.length > 0) {
        removeCompetitor(competitors.length - 1);
      }
    });

    document.getElementById('competitorsInput').addEventListener('paste', function(e) {
      e.preventDefault();
      var text = (e.clipboardData || window.clipboardData).getData('text');
      var items = text.split(/[\n,;]+/);
      for (var i = 0; i < items.length; i++) {
        if (items[i].trim()) addCompetitor(items[i]);
      }
    });

    document.getElementById('competitorsTags').addEventListener('click', function(e) {
      if (e.target.classList.contains('tag-remove')) {
        removeCompetitor(parseInt(e.target.dataset.idx));
      }
    });

    // ======================================
    // Utility: extract spreadsheet ID from URL
    // ======================================
    function extractSpreadsheetId(url) {
      var match = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
      return match ? match[1] : null;
    }

    // ======================================
    // Utility: copy to clipboard
    // ======================================
    function copyToClipboard(url, btnEl) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(url).then(function() {
          showCopied(btnEl);
        }).catch(function() {
          fallbackCopy(url, btnEl);
        });
      } else {
        fallbackCopy(url, btnEl);
      }
    }

    function fallbackCopy(url, btnEl) {
      var ta = document.createElement('textarea');
      ta.value = url;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      try { document.execCommand('copy'); } catch(e) {}
      document.body.removeChild(ta);
      showCopied(btnEl);
    }

    function showCopied(btnEl) {
      var orig = btnEl.textContent;
      btnEl.classList.add('copied');
      btnEl.textContent = '‚úì';
      setTimeout(function() {
        btnEl.classList.remove('copied');
        btnEl.textContent = orig;
      }, 2000);
    }

    // ======================================
    // Utility: section result renderers
    // ======================================
    function showSectionResult(elementId, status, label, url, linkClass) {
      var el = document.getElementById(elementId);
      if (!el) return;
      el.style.display = 'block';

      if (status === 'success' && url) {
        el.className = 'section-result success';
        var cls = linkClass ? 'section-result-link ' + linkClass : 'section-result-link';
        el.innerHTML =
          '<div class="section-result-header">' +
            '<span class="section-result-icon">‚úì</span>' +
            '<span>' + label + '</span>' +
          '</div>' +
          '<div class="section-result-link-row">' +
            '<a href="' + url + '" target="_blank" class="' + cls + '">' +
              'üìä –í—ñ–¥–∫—Ä–∏—Ç–∏ ‚Üí' +
            '</a>' +
            '<button class="copy-btn" onclick="copyToClipboard(\'' + url.replace(/'/g, "\\'") + '\', this)" title="–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è">üìã</button>' +
          '</div>';
      } else if (status === 'success') {
        el.className = 'section-result success';
        el.innerHTML =
          '<div class="section-result-header">' +
            '<span class="section-result-icon">‚úì</span>' +
            '<span>' + label + ' ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>' +
          '</div>';
      } else {
        el.className = 'section-result error';
        el.innerHTML =
          '<div class="section-result-header">' +
            '<span class="section-result-icon">‚úï</span>' +
            '<span>' + label + ' ‚Äî –ø–æ–º–∏–ª–∫–∞</span>' +
          '</div>';
      }
    }

    function showSectionError(elementId, message) {
      var el = document.getElementById(elementId);
      if (!el) return;
      el.style.display = 'block';
      el.className = 'section-result error';
      el.innerHTML =
        '<div class="section-result-header">' +
          '<span class="section-result-icon">‚úï</span>' +
          '<span>' + message + '</span>' +
        '</div>';
    }

    function showSectionLoading(elementId, message) {
      var el = document.getElementById(elementId);
      if (!el) return;
      el.style.display = 'block';
      el.className = 'section-result loading';
      el.innerHTML =
        '<div class="section-result-header">' +
          '<span class="section-result-icon">‚è≥</span>' +
          '<span>' + message + '</span>' +
        '</div>';
    }

    function showCompetitorsResult(competitorsData) {
      var el = document.getElementById('competitorsResult');
      if (!el) return;
      el.style.display = 'block';

      var allSuccess = true;
      for (var i = 0; i < competitorsData.length; i++) {
        if (competitorsData[i].status !== 'success') allSuccess = false;
      }

      el.className = 'section-result ' + (allSuccess ? 'success' : 'error');
      var html = '<div class="section-result-header">' +
        '<span class="section-result-icon">' + (allSuccess ? '‚úì' : '‚ö†') + '</span>' +
        '<span>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–∏: ' + competitorsData.length + ' –¥–æ–º–µ–Ω—ñ–≤</span></div>';

      for (var i = 0; i < competitorsData.length; i++) {
        var c = competitorsData[i];
        html += '<div class="competitor-result-item">';
        html += '<span class="status-dot ' + c.status + '"></span>';
        html += '<span>' + c.domain + '</span>';
        if (c.status === 'success' && c.spreadsheet_url) {
          html += ' ‚Äî <a href="' + c.spreadsheet_url + '" target="_blank">—Ç–∞–±–ª–∏—Ü—è</a>';
          html += ' <button class="copy-btn" onclick="copyToClipboard(\'' + c.spreadsheet_url.replace(/'/g, "\\'") + '\', this)" title="–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏">üìã</button>';
        }
        html += '</div>';
      }

      el.innerHTML = html;
    }

    function clearPhase1Results() {
      var ids = ['clientResult', 'competitorsResult', 'semanticResult', 'phase1Result'];
      for (var i = 0; i < ids.length; i++) {
        var el = document.getElementById(ids[i]);
        if (el) { el.style.display = 'none'; el.className = (ids[i] === 'phase1Result') ? 'result' : 'section-result'; el.innerHTML = ''; }
      }
    }

    // ======================================
    // PHASE 1: Submit (orchestrator)
    // ======================================
    var phase1Results = {};

    function handlePhase1Submit() {
      var email = document.getElementById('managerEmail').value.trim();
      if (!email) { showPhase1Error('–í–≤–µ–¥—ñ—Ç—å email –º–µ–Ω–µ–¥–∂–µ—Ä–∞'); return; }
      if (!email.includes('@')) { showPhase1Error('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç email'); return; }

      var anyActive = isSectionActive('clientSection') || isSectionActive('competitorsSection') ||
        isSectionActive('semanticSection');
      if (!anyActive) { showPhase1Error('–£–≤—ñ–º–∫–Ω—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –±–ª–æ–∫ –ï—Ç–∞–ø—É 1'); return; }

      var clientDomain = '';
      if (isSectionActive('clientSection')) {
        clientDomain = document.getElementById('clientDomain').value.trim();
        if (!clientDomain) { showPhase1Error('–í–≤–µ–¥—ñ—Ç—å –¥–æ–º–µ–Ω –∫–ª—ñ—î–Ω—Ç–∞ –∞–±–æ –≤–∏–º–∫–Ω—ñ—Ç—å –±–ª–æ–∫'); return; }
      }

      if (isSectionActive('competitorsSection') && competitors.length === 0) {
        showPhase1Error('–î–æ–¥–∞–π—Ç–µ —Ö–æ—á–∞ –± –æ–¥–Ω–æ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ –∞–±–æ –≤–∏–º–∫–Ω—ñ—Ç—å –±–ª–æ–∫'); return;
      }

      if (isSectionActive('semanticSection')) {
        var sUrl = document.getElementById('semanticUrl').value.trim();
        if (!sUrl || !sUrl.includes('docs.google.com/spreadsheets')) {
          showPhase1Error('–ù–µ–≤—ñ—Ä–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏–∫–∏'); return;
        }
      }

      // Build formData (Phase 1 only)
      var formData = { manager_email: email };

      if (isSectionActive('clientSection')) {
        formData.client_domain = clientDomain;
      }

      if (isSectionActive('competitorsSection')) {
        formData.competitors = competitors.slice();
      }

      if (isSectionActive('semanticSection')) {
        formData.semantic_expansion = {
          report_name: '–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ —è–¥—Ä–∞',
          spreadsheet_url: document.getElementById('semanticUrl').value.trim(),
          language: document.getElementById('semanticLang').value,
          geo_target: document.getElementById('semanticGeo').value
        };
      }

      // UI: loading
      var btn = document.getElementById('phase1Btn');
      btn.disabled = true;
      btn.classList.add('btn-loading');
      clearPhase1Results();

      google.script.run
        .withSuccessHandler(function(response) {
          btn.disabled = false;
          btn.classList.remove('btn-loading');
          if (response.success) {
            showPhase1Success(response);
          } else {
            showPhase1Error(response.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞');
          }
        })
        .withFailureHandler(function(error) {
          btn.disabled = false;
          btn.classList.remove('btn-loading');
          showPhase1Error(error.toString());
        })
        .submitAnalizDomenu(formData);
    }

    function showPhase1Success(data) {
      var d = data.details || {};

      // Overall result
      var r = document.getElementById('phase1Result');
      r.className = 'result success';
      var folderHtml = '<div class="result-header">' +
        '<div class="result-icon" style="background:#dcfce7;color:#16a34a;">‚úì</div>' +
        '<h3 style="color:#15803d;">–ï—Ç–∞–ø 1 –∑–∞–≤–µ—Ä—à–µ–Ω–æ</h3>' +
        '</div>' +
        '<p>–ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç—É —Å—Ç–≤–æ—Ä–µ–Ω–∞. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑—ñ–±—Ä–∞–Ω—ñ.</p>';
      if (data.folderUrl) {
        folderHtml += '<a href="' + data.folderUrl + '" target="_blank">üìÇ –í—ñ–¥–∫—Ä–∏—Ç–∏ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç—É ‚Üí</a>';
      }
      r.innerHTML = folderHtml;

      // Per-section results
      if (d.client_analysis) {
        showSectionResult('clientResult', d.client_analysis.status, '–ê–Ω–∞–ª—ñ–∑ –∫–ª—ñ—î–Ω—Ç–∞',
          d.client_analysis.spreadsheet_url);
        if (d.client_analysis.spreadsheet_url) {
          phase1Results.client = d.client_analysis.spreadsheet_url;
        }
      }

      if (d.competitors_analysis && d.competitors_analysis.length > 0) {
        showCompetitorsResult(d.competitors_analysis);
      }

      if (d.semantic_expansion) {
        var semExtra = d.semantic_expansion.total_keywords
          ? ' (' + d.semantic_expansion.total_keywords + ' –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤)'
          : '';
        showSectionResult('semanticResult', d.semantic_expansion.status,
          '–°–µ–º–∞–Ω—Ç–∏—á–Ω–µ —è–¥—Ä–æ' + semExtra, d.semantic_expansion.spreadsheet_url);
        if (d.semantic_expansion.spreadsheet_url) {
          phase1Results.semantic = d.semantic_expansion.spreadsheet_url;
        }
      }

      // Show Phase 2 hint
      document.getElementById('phase2Hint').classList.add('visible');
    }

    function showPhase1Error(message) {
      var r = document.getElementById('phase1Result');
      r.className = 'result error';
      r.innerHTML =
        '<div class="result-header">' +
          '<div class="result-icon" style="background:#fee2e2;color:#dc2626;">‚úï</div>' +
          '<h3 style="color:#dc2626;">–ü–æ–º–∏–ª–∫–∞</h3>' +
        '</div>' +
        '<p>' + message + '</p>';
    }

    // ======================================
    // PHASE 2: Metrics (individual)
    // ======================================
    function handleMetricsSubmit() {
      var mUrl = document.getElementById('metricsUrl').value.trim();
      if (!mUrl || !mUrl.includes('docs.google.com/spreadsheets')) {
        showSectionError('metricsResult', '–ù–µ–≤—ñ—Ä–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é –∑ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏');
        return;
      }

      var spreadsheetId = extractSpreadsheetId(mUrl);
      if (!spreadsheetId) {
        showSectionError('metricsResult', '–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ ID —Ç–∞–±–ª–∏—Ü—ñ');
        return;
      }

      var btn = document.getElementById('metricsBtn');
      btn.disabled = true;
      btn.classList.add('btn-section-loading');
      showSectionLoading('metricsResult', '–û—Ç—Ä–∏–º–∞–Ω–Ω—è –º–µ—Ç—Ä–∏–∫...');

      var formData = {
        source_spreadsheet_id: spreadsheetId,
        doc_name: 'GKP Metrics - ' + new Date().toISOString().slice(0, 10),
        language: document.getElementById('metricsLang').value,
        geo_target: document.getElementById('metricsGeo').value
      };

      google.script.run
        .withSuccessHandler(function(response) {
          btn.disabled = false;
          btn.classList.remove('btn-section-loading');
          if (response.success) {
            var extra = response.totalKeywords ? ' (' + response.totalKeywords + ' –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤)' : '';
            showSectionResult('metricsResult', 'success', '–ú–µ—Ç—Ä–∏–∫–∏ –æ—Ç—Ä–∏–º–∞–Ω–æ' + extra, response.spreadsheetUrl);
          } else {
            showSectionError('metricsResult', response.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞');
          }
        })
        .withFailureHandler(function(error) {
          btn.disabled = false;
          btn.classList.remove('btn-section-loading');
          showSectionError('metricsResult', error.toString());
        })
        .submitGKPMetrics(formData);
    }

    // ======================================
    // PHASE 2: PageSpeed (individual)
    // ======================================
    function handlePageSpeedSubmit() {
      var pUrl = document.getElementById('pagespeedUrl').value.trim();
      if (!pUrl || !pUrl.includes('docs.google.com/spreadsheets')) {
        showSectionError('pagespeedResult', '–ù–µ–≤—ñ—Ä–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é –∑ URL');
        return;
      }

      var btn = document.getElementById('pagespeedBtn');
      btn.disabled = true;
      btn.classList.add('btn-section-loading');
      showSectionLoading('pagespeedResult', '–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è PageSpeed...');

      var formData = {
        spreadsheetUrl: pUrl,
        testMobile: document.getElementById('optMobile').classList.contains('selected'),
        testDesktop: document.getElementById('optDesktop').classList.contains('selected')
      };

      google.script.run
        .withSuccessHandler(function(response) {
          btn.disabled = false;
          btn.classList.remove('btn-section-loading');
          if (response.success) {
            var extra = response.totalUrls ? ' (' + response.totalUrls + ' URL)' : '';
            showSectionResult('pagespeedResult', 'success', 'PageSpeed –∑–∞–≤–µ—Ä—à–µ–Ω–æ' + extra, response.spreadsheetUrl);
          } else {
            showSectionError('pagespeedResult', response.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞');
          }
        })
        .withFailureHandler(function(error) {
          btn.disabled = false;
          btn.classList.remove('btn-section-loading');
          showSectionError('pagespeedResult', error.toString());
        })
        .submitPageSpeedTest(formData);
    }

    // ======================================
    // PHASE 2: AI Analysis (individual)
    // ======================================
    function handleAiSubmit() {
      var url = document.getElementById('aiSpreadsheetUrl').value.trim();
      if (!url || !url.includes('docs.google.com/spreadsheets')) {
        showSectionError('aiResult', '–ù–µ–≤—ñ—Ä–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é. –ú–∞—î –±—É—Ç–∏ Google Sheets URL.');
        return;
      }

      var btn = document.getElementById('aiBtn');
      btn.disabled = true;
      btn.classList.add('btn-section-loading');
      showSectionLoading('aiResult', '–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è AI-–∑–≤—ñ—Ç—É...');

      google.script.run
        .withSuccessHandler(function(response) {
          btn.disabled = false;
          btn.classList.remove('btn-section-loading');
          if (response.success) {
            var label = 'AI-–∑–≤—ñ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ' + (response.domain ? ' (' + response.domain + ')' : '');
            showSectionResult('aiResult', 'success', label, response.docUrl, 'ai-link');
          } else {
            showSectionError('aiResult', response.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞');
          }
        })
        .withFailureHandler(function(error) {
          btn.disabled = false;
          btn.classList.remove('btn-section-loading');
          showSectionError('aiResult', error.toString());
        })
        .submitAIAnalysis(url);
    }

    // ======================================
    // PHASE 2: PDF Parsing (individual)
    // ======================================
    function handlePdfSubmit() {
      var url = document.getElementById('pdfUrl').value.trim();
      if (!url || !url.includes('drive.google.com')) {
        showSectionError('pdfResult', '–ù–µ–≤—ñ—Ä–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ PDF. –ú–∞—î –±—É—Ç–∏ Google Drive URL.');
        return;
      }

      var btn = document.getElementById('pdfBtn');
      btn.disabled = true;
      btn.classList.add('btn-section-loading');
      showSectionLoading('pdfResult', '–ü–∞—Ä—Å–∏–Ω–≥ PDF...');

      google.script.run
        .withSuccessHandler(function(response) {
          btn.disabled = false;
          btn.classList.remove('btn-section-loading');
          if (response.success) {
            var extra = response.totalSheets ? ' (' + response.totalSheets + ' –≤–∫–ª–∞–¥–æ–∫)' : '';
            showSectionResult('pdfResult', 'success', 'PDF –æ–±—Ä–æ–±–ª–µ–Ω–æ' + extra, response.spreadsheetUrl);
          } else {
            showSectionError('pdfResult', response.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞');
          }
        })
        .withFailureHandler(function(error) {
          btn.disabled = false;
          btn.classList.remove('btn-section-loading');
          showSectionError('pdfResult', error.toString());
        })
        .submitPdfAuditParse({ pdfUrl: url });
    }

    // ======================================
    // Init
    // ======================================
    document.getElementById('managerEmail').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') handlePhase1Submit();
    });

    document.getElementById('managerEmail').focus();
  </script>
</body>
</html>
