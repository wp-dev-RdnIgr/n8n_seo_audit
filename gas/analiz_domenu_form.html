<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
      min-height: 100vh;
      padding: 24px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .container { width: 100%; max-width: 560px; margin-top: 16px; }

    .card {
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 20px;
      padding: 36px 32px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
    }

    .header { text-align: center; margin-bottom: 28px; }
    .logo {
      width: 56px; height: 56px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 18px;
      font-size: 24px;
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
    }
    .header h1 { font-size: 21px; font-weight: 700; color: #1e293b; margin-bottom: 6px; letter-spacing: -0.3px; }
    .header p { font-size: 13px; color: #64748b; line-height: 1.5; }

    /* Form */
    .form-group { margin-bottom: 16px; }
    label { display: block; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 6px; }

    .input-wrapper { position: relative; }
    .input-icon {
      position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      font-size: 16px; opacity: 0.4; pointer-events: none; transition: opacity 0.2s;
    }

    input[type="text"], input[type="email"], select {
      width: 100%;
      padding: 12px 12px 12px 42px;
      font-size: 14px; font-family: inherit; color: #1e293b;
      background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 10px;
      outline: none; transition: all 0.2s ease;
    }
    select { padding-left: 12px; cursor: pointer; }

    input::placeholder { color: #94a3b8; }
    input:hover, select:hover { border-color: #cbd5e1; background: #f1f5f9; }
    input:focus, select:focus { border-color: #6366f1; background: #fff; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.12); }
    input:focus + .input-icon { opacity: 0.7; }

    /* Section blocks */
    .section-block {
      margin-top: 20px;
      border: 1.5px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
      transition: border-color 0.2s;
    }
    .section-block.active { border-color: #a5b4fc; }

    .section-header {
      display: flex; align-items: center; gap: 12px;
      padding: 14px 16px;
      background: #f8fafc;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s;
    }
    .section-header:hover { background: #f1f5f9; }
    .section-block.active .section-header { background: #eef2ff; }

    .section-toggle {
      width: 38px; height: 22px;
      background: #cbd5e1; border-radius: 11px;
      position: relative; flex-shrink: 0;
      transition: background 0.2s;
      cursor: pointer;
    }
    .section-toggle::after {
      content: '';
      position: absolute; top: 3px; left: 3px;
      width: 16px; height: 16px;
      background: white; border-radius: 50%;
      transition: transform 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }
    .section-block.active .section-toggle { background: #6366f1; }
    .section-block.active .section-toggle::after { transform: translateX(16px); }

    .section-icon { font-size: 18px; }
    .section-title { flex: 1; font-size: 14px; font-weight: 600; color: #374151; }
    .section-desc { font-size: 11px; color: #94a3b8; font-weight: 400; }

    .section-body {
      max-height: 0; overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
      padding: 0 16px;
    }
    .section-block.active .section-body {
      max-height: 500px;
      padding: 16px;
    }

    .row { display: flex; gap: 12px; }
    .row .form-group { flex: 1; }

    /* Tags input for competitors */
    .tags-container {
      display: flex; flex-wrap: wrap; gap: 6px;
      padding: 8px 10px;
      min-height: 44px;
      background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 10px;
      cursor: text; transition: all 0.2s;
    }
    .tags-container:focus-within {
      border-color: #6366f1; background: #fff;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.12);
    }

    .tag {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 4px 10px;
      background: #eef2ff; border: 1px solid #c7d2fe; border-radius: 6px;
      font-size: 13px; color: #4338ca;
      animation: tagIn 0.15s ease;
    }
    @keyframes tagIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    .tag-remove {
      cursor: pointer; font-size: 14px; color: #818cf8;
      width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;
      border-radius: 4px; transition: all 0.15s;
    }
    .tag-remove:hover { color: #dc2626; background: #fee2e2; }

    .tags-input {
      flex: 1; min-width: 80px; border: none; outline: none;
      font-size: 13px; font-family: inherit; background: transparent;
      padding: 4px 0;
    }

    .tags-hint {
      font-size: 11px; color: #94a3b8; margin-top: 4px;
    }

    /* Options cards */
    .options-row { display: flex; gap: 8px; }
    .option-card {
      flex: 1; display: flex; align-items: center; gap: 8px;
      padding: 10px 12px;
      background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 8px;
      cursor: pointer; user-select: none; transition: all 0.15s;
    }
    .option-card:hover { border-color: #cbd5e1; }
    .option-card.selected { background: #eef2ff; border-color: #a5b4fc; }
    .option-icon { font-size: 16px; }
    .option-label { font-size: 13px; font-weight: 500; color: #374151; }
    .option-check { font-size: 14px; margin-left: auto; }

    /* Button */
    .btn {
      width: 100%; padding: 14px 24px; margin-top: 24px;
      font-size: 14px; font-weight: 600; font-family: inherit;
      color: white; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border: none; border-radius: 10px; cursor: pointer;
      transition: all 0.2s ease; position: relative; overflow: hidden; letter-spacing: 0.2px;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.35); }
    .btn:active { transform: translateY(0); }
    .btn span { display: flex; align-items: center; justify-content: center; gap: 8px; }
    .btn:disabled { opacity: 0.65; cursor: not-allowed; transform: none; box-shadow: none; }

    .btn-loading span { visibility: hidden; }
    .btn-loading::after {
      content: ''; position: absolute; top: 50%; left: 50%;
      width: 20px; height: 20px; margin: -10px 0 0 -10px;
      border: 2px solid rgba(255,255,255,0.3); border-top-color: white;
      border-radius: 50%; animation: spin 0.7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Result */
    .result {
      margin-top: 20px; padding: 16px 18px; border-radius: 10px;
      display: none; animation: slideIn 0.25s ease;
    }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }
    .result.success { display: block; background: #f0fdf4; border: 1px solid #bbf7d0; }
    .result.error { display: block; background: #fef2f2; border: 1px solid #fecaca; }

    .result-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .result-icon {
      width: 28px; height: 28px; border-radius: 7px;
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; font-weight: 700;
    }
    .result.success .result-icon { background: #dcfce7; color: #16a34a; }
    .result.error .result-icon { background: #fee2e2; color: #dc2626; }
    .result h3 { font-size: 14px; font-weight: 600; }
    .result.success h3 { color: #15803d; }
    .result.error h3 { color: #dc2626; }
    .result p { font-size: 13px; color: #475569; line-height: 1.5; }

    .result a {
      display: inline-flex; align-items: center; gap: 6px;
      margin-top: 12px; padding: 9px 14px;
      font-size: 13px; font-weight: 500;
      color: #15803d; background: #dcfce7; border: 1px solid #bbf7d0;
      border-radius: 7px; text-decoration: none; transition: all 0.2s;
    }
    .result a:hover { background: #bbf7d0; }

    /* Summary list inside result */
    .result-summary { margin-top: 12px; }
    .result-summary-item {
      display: flex; align-items: center; gap: 8px;
      padding: 6px 0; font-size: 13px; color: #475569;
    }
    .status-dot {
      width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
    }
    .status-dot.success { background: #22c55e; }
    .status-dot.error { background: #ef4444; }
    .status-dot.skipped { background: #d1d5db; }

    /* Footer */
    .footer {
      margin-top: 20px; padding-top: 16px; border-top: 1px solid #f3f4f6;
      display: flex; align-items: center; justify-content: space-between;
    }
    .footer-time { display: flex; align-items: center; gap: 6px; font-size: 12px; color: #64748b; }
    .footer-time svg { width: 14px; height: 14px; opacity: 0.6; }
    .footer-brand { font-size: 11px; color: #94a3b8; }
    .footer-brand span { color: #6366f1; font-weight: 600; }

    /* Warning */
    .warning-box {
      margin-top: 12px; padding: 10px 14px;
      background: #fffbeb; border: 1px solid #fde68a; border-radius: 8px;
      font-size: 12px; color: #92400e; line-height: 1.5;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="logo">üöÄ</div>
        <h1>–ê–Ω–∞–ª—ñ–∑ –¥–æ–º–µ–Ω—É ‚Äî –ú–∞—Å—Ç–µ—Ä</h1>
        <p>–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä SEO-–∞—É–¥–∏—Ç—É: –∞–Ω–∞–ª—ñ–∑ –∫–ª—ñ—î–Ω—Ç–∞, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤, —Å–µ–º–∞–Ω—Ç–∏–∫–∞, –º–µ—Ç—Ä–∏–∫–∏, PageSpeed</p>
      </div>

      <!-- Email (required) -->
      <div class="form-group">
        <label>Email –º–µ–Ω–µ–¥–∂–µ—Ä–∞ *</label>
        <div class="input-wrapper">
          <input type="email" id="managerEmail" placeholder="manager@webpromo.com.ua" autocomplete="off" spellcheck="false">
          <span class="input-icon">üìß</span>
        </div>
      </div>

      <!-- 1. Client analysis -->
      <div class="section-block" id="clientSection">
        <div class="section-header" onclick="toggleSection('clientSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">üîç</span>
          <div>
            <div class="section-title">–ê–Ω–∞–ª—ñ–∑ –∫–ª—ñ—î–Ω—Ç–∞</div>
            <div class="section-desc">SEO-–∞—É–¥–∏—Ç –¥–æ–º–µ–Ω—É –∫–ª—ñ—î–Ω—Ç–∞</div>
          </div>
        </div>
        <div class="section-body">
          <div class="form-group">
            <label>–î–æ–º–µ–Ω –∫–ª—ñ—î–Ω—Ç–∞</label>
            <div class="input-wrapper">
              <input type="text" id="clientDomain" placeholder="example.com.ua" autocomplete="off" spellcheck="false">
              <span class="input-icon">üîó</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 2. Competitors -->
      <div class="section-block" id="competitorsSection">
        <div class="section-header" onclick="toggleSection('competitorsSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">‚öîÔ∏è</span>
          <div>
            <div class="section-title">–ê–Ω–∞–ª—ñ–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤</div>
            <div class="section-desc">SEO-–∞—É–¥–∏—Ç –¥–æ–º–µ–Ω—ñ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤</div>
          </div>
        </div>
        <div class="section-body">
          <div class="form-group">
            <label>–î–æ–º–µ–Ω–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤</label>
            <div class="tags-container" id="competitorsTags" onclick="document.getElementById('competitorsInput').focus()">
              <input type="text" class="tags-input" id="competitorsInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –¥–æ–º–µ–Ω —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Enter" spellcheck="false">
            </div>
            <div class="tags-hint">Enter ‚Äî –¥–æ–¥–∞—Ç–∏, Backspace ‚Äî –≤–∏–¥–∞–ª–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π. –ú–æ–∂–Ω–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ Ctrl+V</div>
          </div>
        </div>
      </div>

      <!-- 3. Semantic expansion -->
      <div class="section-block" id="semanticSection">
        <div class="section-header" onclick="toggleSection('semanticSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">üå±</span>
          <div>
            <div class="section-title">–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ —è–¥—Ä–∞</div>
            <div class="section-desc">GKP: –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —ñ–¥–µ–π –∑ seed-—Ñ—Ä–∞–∑</div>
          </div>
        </div>
        <div class="section-body">
          <div class="form-group">
            <label>–¢–∞–±–ª–∏—Ü—è –∑ seed-—Ñ—Ä–∞–∑–∞–º–∏</label>
            <div class="input-wrapper">
              <input type="text" id="semanticUrl" placeholder="https://docs.google.com/spreadsheets/d/..." autocomplete="off" spellcheck="false">
              <span class="input-icon">üìã</span>
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label>–ú–æ–≤–∞</label>
              <select id="semanticLang">
                <option value="1056" selected>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                <option value="1031">–†—É—Å—Å–∫–∏–π</option>
                <option value="1000">English</option>
              </select>
            </div>
            <div class="form-group">
              <label>–†–µ–≥—ñ–æ–Ω</label>
              <select id="semanticGeo">
                <option value="2804" selected>–£–∫—Ä–∞—ó–Ω–∞</option>
                <option value="2276">–ù—ñ–º–µ—á—á–∏–Ω–∞</option>
                <option value="2616">–ü–æ–ª—å—â–∞</option>
                <option value="2840">–°–®–ê</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- 4. Metrics -->
      <div class="section-block" id="metricsSection">
        <div class="section-header" onclick="toggleSection('metricsSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">üìä</span>
          <div>
            <div class="section-title">–û—Ç—Ä–∏–º–∞–Ω–Ω—è –º–µ—Ç—Ä–∏–∫</div>
            <div class="section-desc">GKP: –æ–±'—î–º –ø–æ—à—É–∫—É –¥–ª—è –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤</div>
          </div>
        </div>
        <div class="section-body">
          <div class="form-group">
            <label>–¢–∞–±–ª–∏—Ü—è –∑ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏</label>
            <div class="input-wrapper">
              <input type="text" id="metricsUrl" placeholder="https://docs.google.com/spreadsheets/d/..." autocomplete="off" spellcheck="false">
              <span class="input-icon">üìã</span>
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label>–ú–æ–≤–∞</label>
              <select id="metricsLang">
                <option value="1056" selected>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                <option value="1031">–†—É—Å—Å–∫–∏–π</option>
                <option value="1000">English</option>
              </select>
            </div>
            <div class="form-group">
              <label>–†–µ–≥—ñ–æ–Ω</label>
              <select id="metricsGeo">
                <option value="2804" selected>–£–∫—Ä–∞—ó–Ω–∞</option>
                <option value="2276">–ù—ñ–º–µ—á—á–∏–Ω–∞</option>
                <option value="2616">–ü–æ–ª—å—â–∞</option>
                <option value="2840">–°–®–ê</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- 5. PageSpeed -->
      <div class="section-block" id="pagespeedSection">
        <div class="section-header" onclick="toggleSection('pagespeedSection')">
          <div class="section-toggle"></div>
          <span class="section-icon">‚ö°</span>
          <div>
            <div class="section-title">PageSpeed Test</div>
            <div class="section-desc">–ê–Ω–∞–ª—ñ–∑ —à–≤–∏–¥–∫–æ—Å—Ç—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫</div>
          </div>
        </div>
        <div class="section-body">
          <div class="form-group">
            <label>–¢–∞–±–ª–∏—Ü—è –∑ URL –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</label>
            <div class="input-wrapper">
              <input type="text" id="pagespeedUrl" placeholder="https://docs.google.com/spreadsheets/d/..." autocomplete="off" spellcheck="false">
              <span class="input-icon">üìã</span>
            </div>
          </div>
          <div class="form-group">
            <label>–¢–∏–ø —Ç–µ—Å—Ç—É</label>
            <div class="options-row">
              <div class="option-card selected" id="optMobile" onclick="toggleOption('optMobile')">
                <span class="option-icon">üì±</span>
                <span class="option-label">Mobile</span>
                <span class="option-check">‚úì</span>
              </div>
              <div class="option-card selected" id="optDesktop" onclick="toggleOption('optDesktop')">
                <span class="option-icon">üñ•Ô∏è</span>
                <span class="option-label">Desktop</span>
                <span class="option-check">‚úì</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="warning-box" id="nothingWarning" style="display: none;">
        –£–≤—ñ–º–∫–Ω—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –±–ª–æ–∫ –∞–Ω–∞–ª—ñ–∑—É
      </div>

      <button class="btn" id="submitBtn" onclick="handleSubmit()">
        <span>üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∞–Ω–∞–ª—ñ–∑</span>
      </button>

      <div class="result" id="result">
        <div class="result-header">
          <div class="result-icon" id="resultIcon"></div>
          <h3 id="resultTitle"></h3>
        </div>
        <p id="resultMessage"></p>
      </div>

      <div class="footer">
        <div class="footer-time">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          –ß–∞—Å –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –æ–±—Ä–∞–Ω–∏—Ö –±–ª–æ–∫—ñ–≤
        </div>
        <div class="footer-brand">
          <span>WebPromo</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // === Section toggles ===
    function toggleSection(sectionId) {
      var el = document.getElementById(sectionId);
      el.classList.toggle('active');
      updateWarning();
    }

    function isSectionActive(sectionId) {
      return document.getElementById(sectionId).classList.contains('active');
    }

    function updateWarning() {
      var anyActive = isSectionActive('clientSection') || isSectionActive('competitorsSection') ||
        isSectionActive('semanticSection') || isSectionActive('metricsSection') || isSectionActive('pagespeedSection');
      document.getElementById('nothingWarning').style.display = anyActive ? 'none' : 'block';
    }

    // === Option cards ===
    function toggleOption(id) {
      document.getElementById(id).classList.toggle('selected');
    }

    // === Competitors tags ===
    var competitors = [];

    function addCompetitor(val) {
      var clean = val.replace(/^https?:\/\//i, '').replace(/^www\./i, '').replace(/\/+$/, '').trim().toLowerCase();
      if (!clean || competitors.indexOf(clean) !== -1) return;
      competitors.push(clean);
      renderCompetitors();
    }

    function removeCompetitor(idx) {
      competitors.splice(idx, 1);
      renderCompetitors();
    }

    function renderCompetitors() {
      var container = document.getElementById('competitorsTags');
      var input = document.getElementById('competitorsInput');
      // Remove existing tags
      var tags = container.querySelectorAll('.tag');
      for (var i = 0; i < tags.length; i++) tags[i].remove();
      // Add tags before input
      for (var i = 0; i < competitors.length; i++) {
        var tag = document.createElement('span');
        tag.className = 'tag';
        tag.innerHTML = competitors[i] + '<span class="tag-remove" data-idx="' + i + '">√ó</span>';
        container.insertBefore(tag, input);
      }
    }

    document.getElementById('competitorsInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        if (this.value.trim()) { addCompetitor(this.value); this.value = ''; }
      }
      if (e.key === 'Backspace' && this.value === '' && competitors.length > 0) {
        removeCompetitor(competitors.length - 1);
      }
    });

    document.getElementById('competitorsInput').addEventListener('paste', function(e) {
      e.preventDefault();
      var text = (e.clipboardData || window.clipboardData).getData('text');
      var items = text.split(/[\n,;]+/);
      for (var i = 0; i < items.length; i++) {
        if (items[i].trim()) addCompetitor(items[i]);
      }
    });

    document.getElementById('competitorsTags').addEventListener('click', function(e) {
      if (e.target.classList.contains('tag-remove')) {
        removeCompetitor(parseInt(e.target.dataset.idx));
      }
    });

    // === Submit ===
    function handleSubmit() {
      var email = document.getElementById('managerEmail').value.trim();
      if (!email) { showError('–í–≤–µ–¥—ñ—Ç—å email –º–µ–Ω–µ–¥–∂–µ—Ä–∞'); return; }
      if (!email.includes('@')) { showError('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç email'); return; }

      var anyActive = isSectionActive('clientSection') || isSectionActive('competitorsSection') ||
        isSectionActive('semanticSection') || isSectionActive('metricsSection') || isSectionActive('pagespeedSection');
      if (!anyActive) { showError('–£–≤—ñ–º–∫–Ω—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –±–ª–æ–∫ –∞–Ω–∞–ª—ñ–∑—É'); return; }

      // Validate active sections
      var clientDomain = '';
      if (isSectionActive('clientSection')) {
        clientDomain = document.getElementById('clientDomain').value.trim();
        if (!clientDomain) { showError('–í–≤–µ–¥—ñ—Ç—å –¥–æ–º–µ–Ω –∫–ª—ñ—î–Ω—Ç–∞ –∞–±–æ –≤–∏–º–∫–Ω—ñ—Ç—å –±–ª–æ–∫'); return; }
      }

      if (isSectionActive('competitorsSection') && competitors.length === 0) {
        showError('–î–æ–¥–∞–π—Ç–µ —Ö–æ—á–∞ –± –æ–¥–Ω–æ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ –∞–±–æ –≤–∏–º–∫–Ω—ñ—Ç—å –±–ª–æ–∫'); return;
      }

      if (isSectionActive('semanticSection')) {
        var sUrl = document.getElementById('semanticUrl').value.trim();
        if (!sUrl || !sUrl.includes('docs.google.com/spreadsheets')) {
          showError('–ù–µ–≤—ñ—Ä–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏–∫–∏'); return;
        }
      }

      if (isSectionActive('metricsSection')) {
        var mUrl = document.getElementById('metricsUrl').value.trim();
        if (!mUrl || !mUrl.includes('docs.google.com/spreadsheets')) {
          showError('–ù–µ–≤—ñ—Ä–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é –¥–ª—è –º–µ—Ç—Ä–∏–∫'); return;
        }
      }

      if (isSectionActive('pagespeedSection')) {
        var pUrl = document.getElementById('pagespeedUrl').value.trim();
        if (!pUrl || !pUrl.includes('docs.google.com/spreadsheets')) {
          showError('–ù–µ–≤—ñ—Ä–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—é –¥–ª—è PageSpeed'); return;
        }
      }

      // Build form data
      var formData = { manager_email: email };

      if (isSectionActive('clientSection')) {
        formData.client_domain = clientDomain;
      }

      if (isSectionActive('competitorsSection')) {
        formData.competitors = competitors.slice();
      }

      if (isSectionActive('semanticSection')) {
        formData.semantic_expansion = {
          report_name: '–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ —è–¥—Ä–∞',
          spreadsheet_url: document.getElementById('semanticUrl').value.trim(),
          language: document.getElementById('semanticLang').value,
          geo_target: document.getElementById('semanticGeo').value
        };
      }

      if (isSectionActive('metricsSection')) {
        formData.metrics_collection = {
          report_name: '–û—Ç—Ä–∏–º–∞–Ω–Ω—è –º–µ—Ç—Ä–∏–∫ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ —è–¥—Ä–∞',
          spreadsheet_url: document.getElementById('metricsUrl').value.trim(),
          language: document.getElementById('metricsLang').value,
          geo_target: document.getElementById('metricsGeo').value
        };
      }

      if (isSectionActive('pagespeedSection')) {
        formData.pagespeed = {
          spreadsheet_url: document.getElementById('pagespeedUrl').value.trim(),
          test_mobile: document.getElementById('optMobile').classList.contains('selected'),
          test_desktop: document.getElementById('optDesktop').classList.contains('selected')
        };
      }

      // Send
      var submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.classList.add('btn-loading');
      document.getElementById('result').className = 'result';

      google.script.run
        .withSuccessHandler(function(response) {
          submitBtn.disabled = false;
          submitBtn.classList.remove('btn-loading');
          if (response.success) {
            showSuccess(response);
          } else {
            showError(response.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞');
          }
        })
        .withFailureHandler(function(error) {
          submitBtn.disabled = false;
          submitBtn.classList.remove('btn-loading');
          showError(error.toString());
        })
        .submitAnalizDomenu(formData);
    }

    function showSuccess(data) {
      var r = document.getElementById('result');
      var ri = document.getElementById('resultIcon');
      var rt = document.getElementById('resultTitle');
      var rm = document.getElementById('resultMessage');
      r.className = 'result success';
      ri.textContent = '‚úì';
      rt.textContent = '–ê–Ω–∞–ª—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ';

      var html = '–ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç—É —Å—Ç–≤–æ—Ä–µ–Ω–∞. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑—ñ–±—Ä–∞–Ω—ñ.';
      html += '<a href="' + data.folderUrl + '" target="_blank">–í—ñ–¥–∫—Ä–∏—Ç–∏ –ø–∞–ø–∫—É ‚Üí</a>';

      if (data.details) {
        html += '<div class="result-summary">';
        var d = data.details;
        if (d.client_analysis) html += summaryItem(d.client_analysis.status, '–ê–Ω–∞–ª—ñ–∑ –∫–ª—ñ—î–Ω—Ç–∞');
        if (d.competitors_analysis && d.competitors_analysis.length > 0) {
          for (var i = 0; i < d.competitors_analysis.length; i++) {
            html += summaryItem(d.competitors_analysis[i].status, '–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç: ' + d.competitors_analysis[i].domain);
          }
        }
        if (d.semantic_expansion) html += summaryItem(d.semantic_expansion.status, '–°–µ–º–∞–Ω—Ç–∏—á–Ω–µ —è–¥—Ä–æ');
        if (d.metrics_collection) html += summaryItem(d.metrics_collection.status, '–ú–µ—Ç—Ä–∏–∫–∏');
        if (d.pagespeed) html += summaryItem(d.pagespeed.status, 'PageSpeed');
        html += '</div>';
      }
      rm.innerHTML = html;
    }

    function summaryItem(status, label) {
      return '<div class="result-summary-item"><span class="status-dot ' + status + '"></span>' + label + '</div>';
    }

    function showError(message) {
      var r = document.getElementById('result');
      r.className = 'result error';
      document.getElementById('resultIcon').textContent = '‚úï';
      document.getElementById('resultTitle').textContent = '–ü–æ–º–∏–ª–∫–∞';
      document.getElementById('resultMessage').textContent = message;
    }

    document.getElementById('managerEmail').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') handleSubmit();
    });

    document.getElementById('managerEmail').focus();
  </script>
</body>
</html>
